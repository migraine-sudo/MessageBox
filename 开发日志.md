# 开发日志



***定义传送的数据结构***  
WEBAPI

定义在com.chinasofti.bean的package中
（客户端和服务端一定要相同）
USER
```
package com.chinasofti.bean;


public class User {
    private String userid;
    private  String username;
    private  String password;
    private int code;

    public String getUserid() {
        return userid;
    }

    public void setUserid(String userid) {
        this.userid = userid;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public int getCode() {
        return code;
    }

    public void setCode(int code) {
        this.code = code;
    }

    public User() {

    }
    public User(String userid,String username,String password) {
        this.userid=userid;
        this.username=username;
        this.password=password;
    }
}

```


Message
```
package com.chinasofti.bean;

public class Message {
    private String Mid;
    private String message;
    private String phone;
    private int code;

    public String getMid() {
        return Mid;
    }

    public void setMid(String mid) {
        Mid = mid;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public int getCode() {
        return code;
    }

    public void setCode(int code) {
        this.code = code;
    }

    public Message() {
    }
    public Message(String mid,String message,String phone) {
        this.Mid=mid;
        this.message=message;
        this.phone=phone;
    }
}

```

UM(USER and Message)
```
package com.chinasofti.bean;

public class UM {
    private String id;
    private  String username;
    private  String phone;
    private int code;

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public int getCode() {
        return code;
    }

    public void setCode(int code) {
        this.code = code;
    }

    public UM() {

    }
    public UM(String id,String username,String phone) {
        this.id=id;
        this.username=username;
        this.phone=phone;
    }
}

```

## 服务端

***JAVAWEB***

环境:MyEclipse  

web.xml
但是后面开发因为Servlet文件中的@WebServlet("/UserRegist")这些代码，所以web.xml也可以不写
[参考资料](https://blog.csdn.net/qq_37465368/article/details/80807689)
```
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://java.sun.com/xml/ns/javaee"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
		  http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
           version="2.5">

    <servlet>
        <servlet-name>UserLoginServlet</servlet-name>
        <servlet-class>com.china.servlet.UserLoginServlet</servlet-class>
    </servlet>
    <servlet>
        <servlet-name>UserRegistServlet</servlet-name>
        <servlet-class>com.china.servlet.UserRegistServlet</servlet-class>
    </servlet>
    <servlet>
        <servlet-name>UserUpdateServlet</servlet-name>
        <servlet-class>com.china.servlet.UserUpdateServlet</servlet-class>
    </servlet>
    <servlet>
        <servlet-name>readMesssgeServlet</servlet-name>
        <servlet-class>com.china.servlet.ReadMesssgeServlet</servlet-class>
    </servlet>
    <servlet>
        <servlet-name>insertMessageServlet</servlet-name>
        <servlet-class>com.china.servlet.InsertMessageServlet</servlet-class>
    </servlet>
    <servlet>
        <servlet-name>deleteMessageServlet</servlet-name>
        <servlet-class>com.china.servlet.DeleteMessageServlet</servlet-class>
    </servlet>
    <servlet>
        <servlet-name>bangdingServlet</servlet-name>
        <servlet-class>com.china.servlet.BangdingServlet</servlet-class>
    </servlet>
    <servlet>
        <servlet-name>UserDeleteServlet</servlet-name>
        <servlet-class>com.china.servlet.UserDeleteServlet</servlet-class>
    </servlet>
    <servlet>
        <servlet-name>deleteBangdingServlet</servlet-name>
        <servlet-class>com.china.servlet.DeleteBangdingServlet</servlet-class>
    </servlet>


    <servlet-mapping>
        <servlet-name>UserLoginServlet</servlet-name>
        <url-pattern>/userLogin</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>UserRegistServlet</servlet-name>
        <url-pattern>/userRegist</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>UserUpdateServlet</servlet-name>
        <url-pattern>/UserUpdate</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>readMesssgeServlet</servlet-name>
        <url-pattern>/readMesssge</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>insertMessageServlet</servlet-name>
        <url-pattern>/insertMessage</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>deleteMessageServlet</servlet-name>
        <url-pattern>/deleteMessage</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>bangdingServlet</servlet-name>
        <url-pattern>/bangDing</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>UserDeleteServlet</servlet-name>
        <url-pattern>/UserDelete</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>deleteBangdingServlet</servlet-name>
        <url-pattern>/deleteBangding</url-pattern>
    </servlet-mapping>


    <welcome-file-list>
        <welcome-file>index.jsp</welcome-file>
    </welcome-file-list>
</web-app>


```



功能实现部分  
***com.chinasofti.dao***包    

MessageDao.java
```
package com.chinasofti.dao;


import com.chinasofti.bean.Message;
import com.chinasofti.utils.JDBCUtil;

import net.sf.json.JSONObject;

import java.io.PrintWriter;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;

public class MessageDao {
    int flag=0;
    public boolean InsertMsg(String message,String phone){
        Connection connection= JDBCUtil.getConnection();
        String sql="insert into message values(null,?,?);";
        PreparedStatement preparedStatement;
        try {
            preparedStatement=connection.prepareStatement(sql);
            preparedStatement.setString(2,message);
            preparedStatement.setString(1,phone);
            flag=preparedStatement.executeUpdate();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return flag!=0;
    }
    public ArrayList <Message> ReadMessage(String username) {

        String sql="select message_id,message from message where message_id in(select message_id from userm,um where userm.userid=um.userid and username=?);";
        Connection connection= JDBCUtil.getConnection();
        PreparedStatement preparedStatement;
        ResultSet resultSet;
        ArrayList <Message> messageList=new ArrayList<Message>();
        //Message message=new Message();
        try {
            preparedStatement=connection.prepareStatement(sql);
            preparedStatement.setString(1,username);

            resultSet=preparedStatement.executeQuery();

            while (resultSet.next()){
            	Message message=new Message();
                String msg_id=resultSet.getString(1);
                String msg=resultSet.getString(2);

                System.out.println("msg="+msg);
                //璧嬪��
                message.setMessage(msg);
                message.setCode(200);
                messageList.add(message);
            }
        } catch (Exception e) {
            //message.setCode(100);
            e.printStackTrace();

        }
        return messageList;
    }
    public boolean deleteMsg(String phone){
        Connection connection= JDBCUtil.getConnection();
        String sql="delete from message where phone=?;";
        PreparedStatement preparedStatement;
        try {
            preparedStatement=connection.prepareStatement(sql);
            preparedStatement.setString(1,phone);
            flag=preparedStatement.executeUpdate();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return flag!=0;
    }
}


```
UMDao.java
```
package com.chinasofti.dao;

import com.chinasofti.utils.JDBCUtil;

import java.sql.Connection;
import java.sql.PreparedStatement;

public class UMDao {
    int flag=0;
    public boolean bangding(String username,String phone){
        Connection connection= JDBCUtil.getConnection();
        String sql="insert into um values(null,?,?);";
        PreparedStatement preparedStatement;
        try {
            preparedStatement=connection.prepareStatement(sql);
            preparedStatement.setString(1,username);
            preparedStatement.setString(2,phone);

            flag=preparedStatement.executeUpdate();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return flag!=0;
    }
}
```

UserDao.java
```
package com.chinasofti.dao;

import com.chinasofti.bean.User;
import com.chinasofti.utils.JDBCUtil;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

public class UserDao {
    int flag=0;
    public boolean registUser(String username,String password){
        Connection connection= JDBCUtil.getConnection();
        String sql="insert into userm values(null,?,?)";
        String sql2="select * from userm where username=?;";
        PreparedStatement preparedStatement;
        try {
        	//判断用户是否注册过
        	preparedStatement=connection.prepareStatement(sql2);
            preparedStatement.setString(1,username);
            ResultSet resultSet;
            resultSet=preparedStatement.executeQuery();
        	if(resultSet.next())
        		return false;

            preparedStatement=connection.prepareStatement(sql);
            preparedStatement.setString(1,username);
            preparedStatement.setString(2,password);

            flag=preparedStatement.executeUpdate();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return flag!=0;
    }

    public User querryUser(String username, String password) {
        User user=new User();
        String sql="select * from userm where username=? and password=?;";
        Connection connection= JDBCUtil.getConnection();
        PreparedStatement preparedStatement;
        ResultSet resultSet;
        try {
            preparedStatement=connection.prepareStatement(sql);
            preparedStatement.setString(1,username);
            preparedStatement.setString(2,password);

            resultSet=preparedStatement.executeQuery();
            while (resultSet.next()){
                String id=resultSet.getString(1);
                String userName=resultSet.getString(2);
                String passWord=resultSet.getString(3);
                //璧嬪�糩
                user.setUserid(id);
                user.setUsername(userName);
                user.setPassword(passWord);
                user.setCode(200);
            }
        } catch (Exception e) {
            user.setCode(100);
            e.printStackTrace();

        }
        return user;
    }

    public boolean updatePassword(String username,String Oldpassword,String Newpassword){
        Connection connection= JDBCUtil.getConnection();
        String sql="update userm set password=? where username=? and password=?;";
        System.out.println(sql);
        PreparedStatement preparedStatement;
        try {
            preparedStatement=connection.prepareStatement(sql);
            preparedStatement.setString(1,Newpassword);
            preparedStatement.setString(2,username);
            preparedStatement.setString(3,Oldpassword);
            flag=preparedStatement.executeUpdate();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return flag!=0;
    }

    public boolean delete(String username){
        Connection connection= JDBCUtil.getConnection();
        String sql="delete from userm where username=?;";
        PreparedStatement preparedStatement;
        try {
            preparedStatement=connection.prepareStatement(sql);
            preparedStatement.setString(1,username);
            flag=preparedStatement.executeUpdate();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return flag!=0;
    }
}


```
***接口设计***       
***com.china.Interface***  
message.java
```package com.chinasofti.Interface;

import net.sf.json.JSONObject;

public interface massage {
    public JSONObject getMsg(String phone);
}


```
UsernamePW.java
```
package com.chinasofti.Interface;

import com.chinasoft.bean.User;
import net.sf.json.JSONObject;

public interface UsernamePW {
    public JSONObject getUP(String username,String password);
}

```

***Servlet***    

***com.chinasofti.servlet***包  

注册接口  

http://localhost:8080/MessageBox_Server_beta/UserRegist?username=231&password=aaa213  

UserRegistServlet.java
```
package com.chinasofti.servlet;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.PrintWriter;

import com.chinasofti.bean.User;
import com.chinasofti.dao.UserDao;
import com.chinasofti.bean.*;
import com.chinasofti.dao.*;
import net.sf.json.JSONObject;


/**
 * Servlet implementation class UserRegistServlet
 */
@WebServlet("/userRegist")
public class UserRegistServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#HttpServlet()
     */
    public UserRegistServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */

        protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            response.setContentType("text/html;charset=utf-8");
            PrintWriter out =response.getWriter();
            UserDao registDao=new UserDao();
            String username=request.getParameter("username");
            String password=request.getParameter("password");

            boolean isRgist=registDao.registUser(username,password);

            User user=new User();
            if (isRgist) {
                user.setCode(200);
                user.setUsername(username);
                user.setPassword(password);
            }else {
                user.setCode(100);
            }
            out.print(JSONObject.fromObject(user));
        }


	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}


```

登陆接口

http://172.20.10.5:8080/MessageBox_Server_beta//userLogin?username=2312&password=aaa213

UserLoginServlet
```
package com.chinasofti.servlet;

import com.chinasofti.bean.User;
import com.chinasofti.dao.UserDao;
import net.sf.json.JSONObject;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;
/**
 * Servlet implementation class UserLoginServlet
 */
@WebServlet("/userLogin")

public class UserLoginServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#HttpServlet()
     */
    public UserLoginServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType("text/html;charset=utf-8");
        PrintWriter out =response.getWriter();

        User user=new UserDao().querryUser(request.getParameter("username"),request.getParameter("password"));
        out.print(JSONObject.fromObject(user).toString());
    }

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}

```
读取短信接口
ReadMessageServlet.java
```
package com.chinasofti.servlet;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.chinasofti.bean.Message;
import com.chinasofti.dao.MessageDao;

import net.sf.json.JSONObject;

/**
 * Servlet implementation class ReadMessageServlet
 */
@WebServlet("/readMessage")
public class ReadMessageServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#HttpServlet()
     */
    public ReadMessageServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType("text/html;charset=utf-8");
        PrintWriter out =response.getWriter();

        ArrayList <Message> messageList=new ArrayList<Message>();
        messageList=new MessageDao().ReadMessage(request.getParameter("username"));
        //构造json
        out.print("{\"package\":[");
        for(int i=0;i<messageList.size();i++)
        {
        	if(i!=0)
        	{
        		out.print(",");
        	}
        	Message message=messageList.get(i);
        	//out.println("msg="+message.getMessage().toString());
        	out.print(JSONObject.fromObject(message).toString());
        }
        out.print("]}");

    }

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}



```
插入短信接口
InsertMessageServlet.java
```
package com.chinasofti.servlet;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.chinasofti.bean.Message;
import com.chinasofti.dao.MessageDao;

import net.sf.json.JSONObject;

/**
 * Servlet implementation class InsertMessageServlet
 */
@WebServlet("/insertMessage")
public class InsertMessageServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#HttpServlet()
     */
    public InsertMessageServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType("text/html;charset=utf-8");
        PrintWriter out =response.getWriter();

        MessageDao messageDao=new MessageDao();
        String message=request.getParameter("message");
        String phone=request.getParameter("phone");

        boolean isRgist=messageDao.InsertMsg(message,phone);

        Message msg=new Message();
        if (isRgist) {
            msg.setCode(200);
            msg.setMessage(message);
            msg.setPhone(phone);
        }else {
            msg.setCode(100);
        }
        out.print(JSONObject.fromObject(msg));
    }

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}


```


绑定接口  
BangdingServlet.java
```
package com.chinasofti.servlet;

import com.chinasofti.bean.UM;
import com.chinasofti.bean.User;
import com.chinasofti.dao.UMDao;
import net.sf.json.JSONObject;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;


public class BangdingServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType("text/html;charset=utf-8");
        PrintWriter out =response.getWriter();
        UMDao umDao=new UMDao();
        String username=request.getParameter("username");
        String phone=request.getParameter("phone");

        boolean isum=umDao.bangding(username,phone);

        UM um=new UM();
        if (isum) {
            um.setCode(200);
            um.setUsername(username);
            um.setPhone(phone);
        }else {
            um.setCode(100);
        }
        out.print(JSONObject.fromObject(um));
    }
}

```

***数据库设计***

数据库的导入
```
MariaDB [(none)]> create database message_cloud;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]> use message_cloud;
Database changed

MariaDB [message_cloud]> source  D:/xxx//MessageBoxes/数据库文件/message_cloud.sql
```
可以看到三张表
```
+-------------------------+
| Tables_in_message_cloud |
+-------------------------+
| message                 |
| um                      |
| userm                   |
+-------------------------+
```

结构
```
MariaDB [message_cloud]> desc message
+------------+--------------+------+-----+---------+----------------+
| Field      | Type         | Null | Key | Default | Extra          |
+------------+--------------+------+-----+---------+----------------+
| message_id | int(10)      | NO   | PRI | NULL    | auto_increment |
| phone      | varchar(255) | NO   | MUL | NULL    |                |
| message    | varchar(255) | NO   |     | NULL    |                |
+------------+--------------+------+-----+---------+----------------+
3 rows in set (0.04 sec)

MariaDB [message_cloud]> desc userm
+----------+--------------+------+-----+---------+----------------+
| Field    | Type         | Null | Key | Default | Extra          |
+----------+--------------+------+-----+---------+----------------+
| userid   | int(10)      | NO   | PRI | NULL    | auto_increment |
| username | varchar(255) | NO   | MUL | NULL    |                |
| password | varchar(255) | NO   |     | NULL    |                |
+----------+--------------+------+-----+---------+----------------+
3 rows in set (0.01 sec)

MariaDB [message_cloud]> desc um;
+------------+---------+------+-----+---------+-------+
| Field      | Type    | Null | Key | Default | Extra |
+------------+---------+------+-----+---------+-------+
| userid     | int(10) | YES  |     | NULL    |       |
| message_id | int(10) | YES  |     | NULL    |       |
+------------+---------+------+-----+---------+-------+
3 rows in set (0.01 sec)

```



JAVAWEB于数据库交互部分
```mysql-connector-java-5.1.39-bin.jar```
myeclipse File-new-Source Floder 取名为lib，并且把驱动放入lib
然后右键```mysql-connector-java-5.1.39-bin.jar```  Build Path
后来实际操作，发现应该放在WEB-INF下面的lib中


****com.chinasofti.utils***

***注意在下列代码中配置数据库以及其账号和密码***

JDBCUtil.java
```
package com.chinasofti.utils;

import java.sql.Connection;
import java.sql.DriverManager;

public class JDBCUtil {


	static Connection connection;

	static{

		 String	driver ="com.mysql.jdbc.Driver";
		 String	url = "jdbc:mysql://localhost:3306/message_cloud?useUnicode=true&characterEncoding=utf8";//数据库名为message_cloud
		 String	username = "root";//账号
		 String	password = "123456";//密码

		try {
			Class.forName(driver);
			connection	 = DriverManager.getConnection(url, username, password);

		} catch (Exception e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
	}
	public static Connection getConnection(){
		return connection;
	}

}
```


<br><br><br>



## 客户端

***Android UI设计***

登录界面UI
```2019.8.21
<?xml version="1.0" encoding="utf-8"?>
<!-- 注释-->
<LinearLayout


    xmlns:android="http://schemas.android.com/apk/res/android"
    android:background="@drawable/grey"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:orientation="vertical"
    android:layout_height="match_parent"
    tools:context=".LoginActivity">

    <ImageView
        android:layout_width="88dp"
        android:layout_height="76dp"

        android:layout_gravity="center"
        android:layout_marginTop="50dp"
        android:src="@mipmap/guge"

        />
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="80dp"
        android:layout_marginTop="50dp"
        android:paddingBottom="30dp"
        android:paddingTop="20dp"
        android:background="#99404348"
        android:gravity="center">
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="center"
            android:text="Welcome"
            android:textColor="#FFFFFF"
            android:textSize="22sp"/>
    </LinearLayout>

<LinearLayout android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:paddingBottom="20dp"
    android:paddingTop="20dp"
    android:background="#99000000">
    <EditText
        android:id="@+id/et_username"
        android:layout_width="match_parent"
        android:layout_height="50dp"
        android:layout_marginTop="0dp"
        android:layout_marginRight="50dp"
        android:layout_marginLeft="50dp"
        android:hint="your username"
        android:textColor="#9F9FA0"
        android:textColorHint="#9F9FA0"
        android:textSize="20sp"
        />

    <EditText
        android:id="@+id/et_password"
        android:layout_width="match_parent"
        android:layout_height="50dp"
        android:layout_alignParentStart="true"
        android:layout_alignParentBottom="true"
        android:layout_marginTop="0dp"
        android:layout_marginRight="50dp"
        android:layout_marginLeft="50dp"
        android:hint="your password"
        android:textColor="#9F9FA0"
        android:textColorHint="#9F9FA0"
        android:textSize="20sp"
        />
</LinearLayout>

    <LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:app="http://schemas.android.com/apk/res-auto"
        xmlns:tools="http://schemas.android.com/tools"
        android:layout_width="300dp"
        android:orientation="horizontal"
        android:layout_height="match_parent"
        android:layout_marginTop="60dp"
        android:layout_gravity="center"
        tools:context=".LoginActivity">

        <Button
            android:id="@+id/btn_login"
            android:layout_marginLeft="10dp"
            android:layout_marginTop="30dp"
            android:layout_width="130dp"
            android:layout_height="60dp"
            android:background="@drawable/buttonstyle"
            android:text="LOGIN IN"

            />
        <Button
            android:id="@+id/btn_regist"
            android:layout_marginLeft="20dp"
            android:layout_marginTop="30dp"
            android:layout_width="130dp"
            android:layout_height="60dp"
            android:background="@drawable/buttonstyle"
            android:text="REGIST"

            />
        ></LinearLayout>
</LinearLayout>
```

buttonstyle.xml
```
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <item android:state_pressed="false">        <shape>
        <!-- 色值 -->
        <solid android:color="#585EE0" />
        <!-- 圆角 -->
        <corners android:radius="10dp" />
    </shape>
    </item>
    <item android:state_pressed="true">
        <shape>
            <!-- 色值 -->
            <solid android:color="#289BE5" />
            <!-- 圆角 -->
            <corners android:radius="10dp" />
        </shape>
    </item>
</selector>
```

主界面UI
activity_main.xml
```

```
需要在layout下创建一个list_item.xml来定义ListView每个单元的格式[参考资料](https://www.cnblogs.com/wangguangjian/p/8831334.html)
```
<?xml version="1.0" encoding="UTF-8"?>
<TextView xmlns:android="http://schemas.android.com/apk/res/android"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:textSize="18sp"
      >
</TextView>
```



***JAVA部分***


打开/app/manifests/AndroidManfest.xml
在 <application...前添加[权限配置]

后来运行时候报错,因为权限问题
```
W/System.err: java.net.SocketException: Permission denied
```
``` <uses-permission android:name="android.permission.INTERNET"/>
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
```
string.xml配置访问的IP
```
<string name="ip_config">http://服务器IP:8080</string>
```

登录界面的JAVA代码
LoginActivity.java
```
package com.example.messageboxes_beta;


import android.content.Intent;
import android.os.Bundle;
import org.json.*;
import android.widget.Toast;

import com.google.android.material.floatingactionbutton.FloatingActionButton;
import com.google.android.material.snackbar.Snackbar;

import androidx.appcompat.app.AppCompatActivity;
import androidx.appcompat.widget.Toolbar;

import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import com.Util.HttpUtil;
import com.Util.OnHttpRepsonLinstener;

import java.io.IOException;


public class LoginActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_login);
        //从 xml获取输入框和Button句柄
        final EditText etUsername=(EditText)findViewById(R.id.et_username);
        final EditText etPassword=findViewById(R.id.et_password);
        Button btnRegist=findViewById(R.id.btn_regist);
        Button btnLogin=findViewById(R.id.btn_login);

        //Click触发btnRegist
        btnRegist.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String username = etUsername.getText().toString();
                String password = etPassword.getText().toString();
                registTX(username,password);
            }
        });
        //Click触发btnLogin
        btnLogin.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String username = etUsername.getText().toString();
                String password = etPassword.getText().toString();
                loginTX(username,password);
            }
        });



    }
    /**
     * 用户登录方法
     *
     * @param username
     * @param password
     */
    private void loginTX(final String username, String password)
    {
        final   String url = getString(R.string.ip_config)+"/MessageBox_Server_beta/userLogin?username="+username+"&password="+password;
        new Thread(new Runnable() {
            @Override
            public void run() {

                HttpUtil.getUrlConnectJson(LoginActivity.this, url, new OnHttpRepsonLinstener() {
                            @Override
                            public void onGetString(String json) {
                                try {
                                    //Toast.makeText(LoginActivity.this, "URL=" + url, Toast.LENGTH_LONG).show();
                                    JSONObject jsonObject = new JSONObject(json);
                                    int code = jsonObject.getInt("code");
                                    //String id=jsonObject.getString("id");
                                    if (code == 200) {
                                        Toast.makeText(LoginActivity.this, "登录成功", Toast.LENGTH_LONG).show();
                                       //跳转到主界面
                                        Intent intent=new Intent(LoginActivity.this,MainActivity.class);
                                        intent.putExtra("username",username);
                                        startActivityForResult(intent,1000);
                                        finish();
                                    } else {
                                        Toast.makeText(LoginActivity.this, "用户名或者密码错误", Toast.LENGTH_LONG).show();
                                    }
                                } catch (JSONException e) {

                                    e.printStackTrace();
                                }
                            }
                        }
                );
            }
        }


        ).start();
    }

    /**
     * 用户注册方法
     *
     * @param username
     * @param password
     */

    private void registTX(String username, String password) {
        //final   String url = getString(R.string.ip_config)+"/message/uRegistServlet?username="+username+"&password="+password;
        final   String url = getString(R.string.ip_config)+"/MessageBox_Server_beta/userRegist?username="+username+"&password="+password;
        //Toast.makeText(LoginActivity.this,"URL="+url,Toast.LENGTH_LONG).show();
        new Thread(new Runnable() {
            @Override
            public void run() {

                HttpUtil.getUrlConnectJson(LoginActivity.this, url, new OnHttpRepsonLinstener() {
                    @Override
                    public void onGetString(String json) {
                        try {
                            //Toast.makeText(LoginActivity.this, "URL=" + url, Toast.LENGTH_LONG).show();
                            JSONObject jsonObject = new JSONObject(json);
                            int code = jsonObject.getInt("code");
                            if (code == 200) {
                                Toast.makeText(LoginActivity.this, "注册成功", Toast.LENGTH_LONG).show();
                            } else {
                                Toast.makeText(LoginActivity.this, "注册失败，用户名已经被注册过了", Toast.LENGTH_LONG).show();
                            }
                        } catch (JSONException e) {

                            e.printStackTrace();
                        }
                    }
                }
                );
            }
        }


    ).start();

    }


}


```

主界面的JAVA代码




MainActivity.java
```
package com.example.messageboxes_beta;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.view.KeyEvent;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.Toast;

import com.Util.HttpUtil;
import com.Util.OnHttpRepsonLinstener;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;


public class MainActivity extends AppCompatActivity {
    private static final CountDownLatch ctl = new CountDownLatch(10);
    private ListView listview;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Bundle bundle= getIntent().getExtras();
        String usernmae=bundle.getString("username");
        System.out.println("username="+usernmae);
        readMessageTX(usernmae);
    }
    //返回登录界面
    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event) {
        if (keyCode == KeyEvent.KEYCODE_BACK && event.getRepeatCount() == 0) {
            Intent intent=new Intent(MainActivity.this,LoginActivity.class);
            startActivityForResult(intent,1000);
            finish();
            overridePendingTransition(android.R.anim.slide_in_left, android.R.anim.slide_out_right);
            return true;
        }
        return super.onKeyDown(keyCode, event);
    }

    List<String> listdata = new ArrayList<String>();

    private void readMessageTX(String username)
    {
        //创建ListView
        listview = (ListView)findViewById(R.id.message_list);
        final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(this, R.layout.list_item, listdata);//listdata和str均可

        final   String url = getString(R.string.ip_config)+"/MessageBox_Server_beta/readMessage?username="+username;

       // listdata.add("Your Message:");

        new Thread(new Runnable() {
            @Override
            public void run() {
                HttpUtil.getUrlConnectJson(MainActivity.this, url, new OnHttpRepsonLinstener() {
                            @Override
                            public void onGetString(String json) {

                                try {
                                    //Toast.makeText(LoginActivity.this, "URL=" + url, Toast.LENGTH_LONG).show();
                                    JSONObject jsonObject = new JSONObject(json);
                                    //int code=jsonObject.getInt("code");
                                    JSONArray message = jsonObject.getJSONArray("package");
                                    JSONObject packageObject=message.getJSONObject(0);
                                    int code=packageObject.getInt("code");

                                    if (code == 200) {
                                       // Toast.makeText(MainActivity.this, "读取数据库中", Toast.LENGTH_LONG).show();
                                        for (int i=0;i<100;i++)
                                        {
                                            try {
                                                JSONObject packageObjectx=message.getJSONObject(i);
                                                if(packageObject!=null)
                                                    listdata.add(packageObjectx.getString("message"));}
                                            catch (JSONException e){e.printStackTrace();}

                                            //System.out.println("message="+packageObjectx.getString("message"));
                                            //Toast.makeText(MainActivity.this, "message="+packageObjectx.getString("message"), Toast.LENGTH_LONG).show();
                                        }
                                        //显示ListView
                                        arrayAdapter.notifyDataSetChanged();
                                        listview.setAdapter(arrayAdapter);

                                    } else {
                                        Toast.makeText(MainActivity.this, "用户还没有上传数据", Toast.LENGTH_LONG).show();
                                    }
                                } catch (JSONException e) {

                                    e.printStackTrace();
                                }

                            }
                        }
                );
            }
        }

        ).start();

        //listview.deferNotifyDataSetChanged();
    }
}
```

首先设置好权限
短信监听需要添加权限
```
<uses-permission android:name="android.permission.RECEIVE_SMS" /> <!-- 接收短信权限 -->
<uses-permission android:name="android.permission.READ_SMS" /> <!-- 读取短信权限 -->

<uses-permission android:name="android.permission.RECEIVE_SMS" >    </uses-permission>  

```
在AndroidMainifest.xml中添加广播接收
```

        <receiver android:name="com.example.messageboxes_beta.SmsReceiver" >
            <intent-filter android:priority="999">
                <action android:name="android.provider.Telephony.SMS_RECEIVED" />
            </intent-filter>
        </receiver>
```

在执行界面的Activity中加入
```
    private Uri SMS_INBOX = Uri.parse("content://sms/");

    public void getSmsFromPhone() {
        new Thread(new Runnable() {
            @Override
            public void run() {
                ContentResolver cr = getContentResolver();
                String[] projection = new String[]{"body"};//"_id", "address", "person",, "date", "type
                String where = " address = '1066321332' AND date >  " + (System.currentTimeMillis() - 10 * 60 * 1000);

                Cursor cur = cr.query(SMS_INBOX, projection, where, null, "date desc");
                Log.e("getSmsFromPhone!","sdfasdfas");
                if (null == cur)
                    return;
                if (cur.moveToNext()) {
                    String number = cur.getString(cur.getColumnIndex("address"));//手机号
                    String name = cur.getString(cur.getColumnIndex("person"));//联系人姓名列表
                    String body = cur.getString(cur.getColumnIndex("body"));
                    //这里我是要获取自己短信服务号码中的验证码~~

                    Pattern pattern = Pattern.compile(" [a-zA-Z0-9]{10}");
                    Matcher matcher = pattern.matcher(body);
                    if (matcher.find()) {
                        String res = matcher.group().substring(1, 11);
                        //mobileText.setText(res);
                        Log.e(
                                "GetMsg=" , res);
                    }
                }

            }
        }

        ).start();
    }

    @Override
    public void onRequestPermissionsResult(int requestCode,String[] permissions,int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        switch (requestCode) {
            case REQUEST_CODE_ASK_PERMISSIONS:
                for (int i = 0; i < permissions.length; i++) {
                    Log.e("TAG",permissions[i]);
                }


//                    Toast.makeText(this, "授权失败，请在设置中打开文件读写权限", Toast.LENGTH_SHORT).show();

                break;
        }
    }

```
创建ContentMsmPrivider
```
package com.example.messageboxes_beta;

import android.content.ContentProvider;
import android.content.ContentValues;
import android.database.Cursor;
import android.net.Uri;

public class ContentMsmPrivider extends ContentProvider {
    @Override
    public boolean onCreate() {
        return false;
    }

    @Override
    public Cursor query(Uri uri, String[] strings, String s, String[] strings1, String s1) {
        return null;
    }

    @Override
    public String getType(Uri uri) {
        return null;
    }

    @Override
    public Uri insert(Uri uri, ContentValues contentValues) {
        return null;
    }

    @Override
    public int delete(Uri uri, String s, String[] strings) {
        return 0;
    }

    @Override
    public int update(Uri uri, ContentValues contentValues, String s, String[] strings) {
        return 0;
    }
}

```

美化字体
[参考链接](https://www.jianshu.com/p/8a1205f410d1)

获取短信
[参考链接](https://blog.csdn.net/u013456079/article/details/68061322)

最终的LoginActivity MainActivity ContentMsmPrivide
 MainActivity
```
package com.example.messageboxes_beta;

import androidx.appcompat.app.AppCompatActivity;

import android.content.ContentResolver;
import android.content.Context;
import android.content.Intent;
import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;
import android.telephony.SmsMessage;
import android.view.KeyEvent;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.Toast;

import com.Util.HttpUtil;
import com.Util.OnHttpRepsonLinstener;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.text.BreakIterator;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;
import java.util.regex.Matcher;
import java.util.regex.Pattern;


public class MainActivity extends AppCompatActivity {
    private static final CountDownLatch ctl = new CountDownLatch(10);
    private ListView listview;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Bundle bundle= getIntent().getExtras();
        String usernmae=bundle.getString("username");
        ArrayList<String> msg=new ArrayList<String>();
        msg=bundle.getStringArrayList("msgArray");

        System.out.println("username="+usernmae);
        for (int i=0;i<msg.size();i++) {
            String url = getString(R.string.ip_config) + "/MessageBox_Server_beta//insertMessage?username=" + usernmae + "&message=" + msg.get(i);
            UploadMeessageTX(url,usernmae);
        }
        readMessageTX(usernmae);

        //System.out.println(msg.get(1));
    }


    //返回登录界面
    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event) {
        if (keyCode == KeyEvent.KEYCODE_BACK && event.getRepeatCount() == 0) {
            Intent intent=new Intent(MainActivity.this,LoginActivity.class);
            startActivityForResult(intent,1000);
            finish();
            overridePendingTransition(android.R.anim.slide_in_left, android.R.anim.slide_out_right);
            return true;
        }
        return super.onKeyDown(keyCode, event);
    }

//上传Message
    private void UploadMeessageTX(String URL,String username)
    {

        // listdata.add("Your Message:");
        final String url=URL;
        new Thread(new Runnable() {
            @Override
            public void run() {
                HttpUtil.getUrlConnectJson(MainActivity.this, url, new OnHttpRepsonLinstener() {
                            @Override
                            public void onGetString(String json) {

                                try {
                                    //Toast.makeText(LoginActivity.this, "URL=" + url, Toast.LENGTH_LONG).show();
                                    JSONObject jsonObject = new JSONObject(json);
                                    int code=jsonObject.getInt("code");

                                    if (code == 200) {
                                        Toast.makeText(MainActivity.this,"上传成功",Toast.LENGTH_LONG);

                                    } else {
                                        Toast.makeText(MainActivity.this, "上传失败", Toast.LENGTH_LONG).show();
                                    }
                                } catch (JSONException e) {

                                    e.printStackTrace();
                                }

                            }
                        }
                );
            }
        }

        ).start();
    }
//读取Message
    List<String> listdata = new ArrayList<String>();
    private void readMessageTX(String username)
    {
        //创建ListView
        listview = (ListView)findViewById(R.id.message_list);
        final ArrayAdapter<String> arrayAdapter = new ArrayAdapter<String>(this, R.layout.list_item, listdata);//listdata和str均可

        final   String url = getString(R.string.ip_config)+"/MessageBox_Server_beta/readMessage?username="+username;

       // listdata.add("Your Message:");

        new Thread(new Runnable() {
            @Override
            public void run() {
                HttpUtil.getUrlConnectJson(MainActivity.this, url, new OnHttpRepsonLinstener() {
                            @Override
                            public void onGetString(String json) {

                                try {
                                    //Toast.makeText(LoginActivity.this, "URL=" + url, Toast.LENGTH_LONG).show();
                                    JSONObject jsonObject = new JSONObject(json);
                                    //int code=jsonObject.getInt("code");
                                    JSONArray message = jsonObject.getJSONArray("package");
                                    JSONObject packageObject=message.getJSONObject(0);
                                    int code=packageObject.getInt("code");

                                    if (code == 200) {
                                       // Toast.makeText(MainActivity.this, "读取数据库中", Toast.LENGTH_LONG).show();
                                        for (int i=0;i<100;i++)
                                        {
                                            try {
                                                JSONObject packageObjectx=message.getJSONObject(i);
                                                if(packageObject!=null)
                                                    listdata.add(packageObjectx.getString("message"));}
                                            catch (JSONException e){e.printStackTrace();}

                                            //System.out.println("message="+packageObjectx.getString("message"));
                                            //Toast.makeText(MainActivity.this, "message="+packageObjectx.getString("message"), Toast.LENGTH_LONG).show();
                                        }
                                        //显示ListView
                                        arrayAdapter.notifyDataSetChanged();
                                        listview.setAdapter(arrayAdapter);

                                    } else {
                                        Toast.makeText(MainActivity.this, "用户还没有上传数据", Toast.LENGTH_LONG).show();
                                    }
                                } catch (JSONException e) {

                                    e.printStackTrace();
                                }

                            }
                        }
                );
            }
        }

        ).start();

        //listview.deferNotifyDataSetChanged();
    }


}


```
LoginActivity
```
package com.example.messageboxes_beta;


import android.Manifest;
import android.content.ContentResolver;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;

import org.json.*;

import android.util.Log;
import android.widget.Toast;

import com.google.android.material.floatingactionbutton.FloatingActionButton;
import com.google.android.material.snackbar.Snackbar;

import androidx.appcompat.app.AppCompatActivity;
import androidx.appcompat.widget.Toolbar;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;

import android.view.View;
import android.widget.Button;
import android.widget.EditText;

import com.Util.HttpUtil;
import com.Util.OnHttpRepsonLinstener;

import java.io.IOException;
import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;


public class LoginActivity extends AppCompatActivity {
    final private int REQUEST_CODE_ASK_PERMISSIONS = 123;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_login);
        //从 xml获取输入框和Button句柄
        final EditText etUsername = (EditText) findViewById(R.id.et_username);
        final EditText etPassword = findViewById(R.id.et_password);
        Button btnRegist = findViewById(R.id.btn_regist);
        Button btnLogin = findViewById(R.id.btn_login);

        //Click触发btnRegist
        btnRegist.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String username = etUsername.getText().toString();
                String password = etPassword.getText().toString();
                registTX(username, password);
            }
        });
        //Click触发btnLogin
        btnLogin.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String username = etUsername.getText().toString();
                String password = etPassword.getText().toString();
                loginTX(username, password);
            }
        });
//        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.M) {
//            int hasWriteContactsPermission = checkSelfPermission(Manifest.permission.READ_CONTACTS);
//            if (hasWriteContactsPermission != PackageManager.PERMISSION_GRANTED){
//                requestPermissions(new String[]{Manifest.permission.WRITE_CONTACTS},REQUEST_CODE_ASK_PERMISSIONS);
//                return;
//            }
//        }
//        verifyStoragePermissions();
        //获取短信提取权限
        ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_SMS}, REQUEST_CODE_ASK_PERMISSIONS);
        getSmsFromPhone();
//        Log.e("TAG",checkSelfPermission(Manifest.permission.READ_SMS)+"");


    }


    private void verifyStoragePermissions() {
        if (
                ContextCompat.checkSelfPermission(this, Manifest.permission.READ_SMS) != PackageManager.PERMISSION_GRANTED) { // 申请权限
            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_SMS}, REQUEST_CODE_ASK_PERMISSIONS);
        }
    }

    /**
     * 用户登录方法
     *
     * @param username
     * @param password
     */
    private void loginTX(final String username, String password) {
        final String url = getString(R.string.ip_config) + "/MessageBox_Server_beta/userLogin?username=" + username + "&password=" + password;
        new Thread(new Runnable() {
            @Override
            public void run() {

                HttpUtil.getUrlConnectJson(LoginActivity.this, url, new OnHttpRepsonLinstener() {
                            @Override
                            public void onGetString(String json) {
                                try {
                                    //Toast.makeText(LoginActivity.this, "URL=" + url, Toast.LENGTH_LONG).show();
                                    JSONObject jsonObject = new JSONObject(json);
                                    int code = jsonObject.getInt("code");
                                    //String id=jsonObject.getString("id");
                                    if (code == 200) {
                                        Toast.makeText(LoginActivity.this, "登录成功", Toast.LENGTH_LONG).show();
                                        //跳转到主界面
                                        Intent intent = new Intent(LoginActivity.this, MainActivity.class);
                                        intent.putExtra("username", username);
                                        intent.putExtra("msgArray",MsgArray);
                                        startActivityForResult(intent, 1000);
                                        finish();
                                    } else {
                                        Toast.makeText(LoginActivity.this, "用户名或者密码错误", Toast.LENGTH_LONG).show();
                                    }
                                } catch (JSONException e) {

                                    e.printStackTrace();
                                }
                            }
                        }
                );
            }
        }


        ).start();
    }

    /**
     * 用户注册方法
     *
     * @param username
     * @param password
     */

    private void registTX(String username, String password) {
        //final   String url = getString(R.string.ip_config)+"/message/uRegistServlet?username="+username+"&password="+password;
        final String url = getString(R.string.ip_config) + "/MessageBox_Server_beta/userRegist?username=" + username + "&password=" + password;
        //Toast.makeText(LoginActivity.this,"URL="+url,Toast.LENGTH_LONG).show();
        new Thread(new Runnable() {
            @Override
            public void run() {

                HttpUtil.getUrlConnectJson(LoginActivity.this, url, new OnHttpRepsonLinstener() {
                            @Override
                            public void onGetString(String json) {
                                try {
                                    //Toast.makeText(LoginActivity.this, "URL=" + url, Toast.LENGTH_LONG).show();
                                    JSONObject jsonObject = new JSONObject(json);
                                    int code = jsonObject.getInt("code");
                                    if (code == 200) {
                                        Toast.makeText(LoginActivity.this, "注册成功", Toast.LENGTH_LONG).show();
                                    } else {
                                        Toast.makeText(LoginActivity.this, "注册失败，用户名已经被注册过了", Toast.LENGTH_LONG).show();
                                    }
                                } catch (JSONException e) {

                                    e.printStackTrace();
                                }
                            }
                        }
                );
            }
        }


        ).start();

    }

    private Uri SMS_INBOX = Uri.parse("content://sms/");

    ArrayList<String> MsgArray=new ArrayList<String>();
    public void getSmsFromPhone() {
        new Thread(new Runnable() {
            @Override
            public void run() {
                ContentResolver cr = getContentResolver();
                String[] projection = new String[]{"body"};//"_id", "address", "person",, "date", "type
                //String where = " address = '10690630746185017590' AND date >  " + (System.currentTimeMillis() - 10 * 60 * 1000);
                //String where = " address = '10690630746185017590'";
                //Cursor cur = cr.query(SMS_INBOX, projection, where, null, "date desc");
                Cursor cur = cr.query(SMS_INBOX, projection, null, null, "date desc");
                Log.e("getSmsFromPhone!","sdfasdfas");
                if (null == cur)
                    return;
                while(cur.moveToNext()) {
                    //String number = cur.getString(cur.getColumnIndex("address"));//手机号
                    //String name = cur.getString(cur.getColumnIndex("person"));//联系人姓名列表
                    String body = cur.getString(cur.getColumnIndex("body"));

                   //System.out.println("Body="+body);
                    //这里我是要获取自己短信服务号码中的验证码~~
                    // Pattern pattern = Pattern.compile(" [a-zA-Z0-9]{10}");
                    Pattern pattern=Pattern.compile("[尊敬]");
                    Matcher matcher = pattern.matcher(body);
                    //System.out.println("find match="+body);
                    if (matcher.find()) {
                        System.out.println("find match="+body);
                        MsgArray.add(body);
                        //String res = matcher.group(1);
                        //mobileText.setText(res);
                       //Log.e(
                        //        "GetMsg=" , res);
                   }

                }
                System.out.print("123");

            }
        }

        ).start();
    }

    @Override
    public void onRequestPermissionsResult(int requestCode,String[] permissions,int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        switch (requestCode) {
            case REQUEST_CODE_ASK_PERMISSIONS:
                for (int i = 0; i < permissions.length; i++) {
                    Log.e("TAG",permissions[i]);
                }
//                    Toast.makeText(this, "授权失败，请在设置中打开文件读写权限", Toast.LENGTH_SHORT).show();
                break;
        }
    }

}
```

ContentMsmPrivide.java
```
package com.example.messageboxes_beta;

import android.content.ContentProvider;
import android.content.ContentValues;
import android.database.Cursor;
import android.net.Uri;

public class ContentMsmPrivider extends ContentProvider {
    @Override
    public boolean onCreate() {
        return false;
    }

    @Override
    public Cursor query(Uri uri, String[] strings, String s, String[] strings1, String s1) {
        return null;
    }

    @Override
    public String getType(Uri uri) {
        return null;
    }

    @Override
    public Uri insert(Uri uri, ContentValues contentValues) {
        return null;
    }

    @Override
    public int delete(Uri uri, String s, String[] strings) {
        return 0;
    }

    @Override
    public int update(Uri uri, ContentValues contentValues, String s, String[] strings) {
        return 0;
    }
}

```
